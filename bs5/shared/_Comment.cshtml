@inherits Custom.Hybrid.Razor12
@using ToSic.Razor.Blade;
@{
  var comment = DynamicModel.Comment;
  var isReply = DynamicModel.ParentId != null;
  var isVisible = DynamicModel.IsVisible ?? true;
  var owner = comment.Entity.Owner;
  var displayName = comment.Pseudonym;
  var userId = "-1";
  if (owner != "anonymous") {
    userId = owner.Replace("dnn:userid=", "");
    if (userId == "1") {
      displayName = "Admin";
    } else {
      var userQuery = App.Query["DNNUser"];
      @* userQuery.Params("UserId", userId); *@
      var user = AsList(userQuery["Default"]).FirstOrDefault();
      displayName = user.DisplayName;
    }
  }
}

<div class='row @(isVisible ? "" : "d-none") @(isReply ? "mb-2" : "mb-3")' style='@(isReply ? "margin-left: 80px;" : "")' app-blog5-parent-id="@DynamicModel.ParentId" app-blog5-comment-id="@comment.EntityId">
  <div class="col-auto mr-2">
    <div class="rounded-circle" style='@(isReply ? "height: 54px; width: 54px;" : "height: 64px; width: 64px;") background-color: lightgray;'>
      <img class="img-fluid rounded-circle" src='@(CmsContext.Site.Url + "/" + "/DnnImageHandler.ashx?mode=profilepic&userId=" + userId)'>
    </div>
  </div>
  <div class="col">
    <div class="container-fluid px-0">
      <div class="row">
        <div class="col-auto">
          <h4>@displayName</h4>
        </div>
        <div class="col-auto">
          <span class="text-muted">@comment.Created.ToString("dd.MM.yyyy HH:mm")</span>
        </div>
      </div>
    </div>
    <p>@comment.Content</p>
    <div app-blog5-reply-wrapper class="container-fluid px-0">
      <div class="row justify-content-between">
        <div class="col-auto">
          @if (!isReply) {
            <button app-blog5-reply-button type="button" class="btn btn-light me-2 mb-3 btn-sm">@Resources.Reply</button>
          }
        </div>
        @if (Edit.Enabled && !comment.IsPublished) {
          <div class="col-auto">
            <button app-blog5-deny-button type="button" class="btn btn-outline-danger me-2 mb-3">@Resources.Deny</button>
            <button app-blog5-publish-button type="button" class="btn btn-outline-success mb-3">@Resources.Approve</button>
          </div>
        }
      </div>
    </div>
  </div>
</div>