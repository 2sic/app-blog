@inherits ToSic.Sxc.Dnn.RazorComponent
@using ToSic.Razor.Blade;
@using ToSic.Sxc.Search;
@using ToSic.Eav.Run;

@RenderPage("shared/_Assets.cshtml")

@{
  var helpers = CreateInstance("shared/_Helpers.cshtml");

  var posts = AsList(Data["Posts"]);
}

@* Show details page warning *@
@if(Edit.Enabled) {
  if(!Text.Has(App.Settings.DetailsPage)) {
    <div class="alert alert-danger" role="alert">@Html.Raw(@App.Resources.LabelAdminDetailPageWarning)</div>
  }
}

<section class="app-blog" @Edit.TagToolbar(Content)>
  <div class="category-header"><h1>@Content.Title</h1></div>

  @* List the posts in 3 columns *@
  <div class="row card-deck">
    @foreach (var post in posts) {
      var imageUrl = Text.Has(post.Image) ? post.Image : App.Resources.PlaceholderMissingImage;

      <article class="list-item col-12 col-md-6 col-lg-4" @Edit.TagToolbar(post, toolbar: new [] {
        "-layout",
        "%new&show=true?contentType=BlogPost&entityId=0",
        "%delete&show=true"
      })>
        <div class="app-blog-readmorelink card m-0">
          <a class="link-overlay"
            href='@Tags.SafeUrl(Link.To(pageId: helpers.GetDetailsPageTabId(), parameters: helpers.DetailPageQueryString(post)))'>
          </a>

          @* Image of the post *@
          @RenderPage("shared/_Post Image.cshtml", new { Post = post, Width = 800, Height = 480 })

          <div class="card-body d-flex flex-column">
            <h5 class="card-title">@post.Title</h5>
            <p class="card-text text">@Html.Raw(Tags.Strip(post.Teaser))</p>
          </div>
          <div class="card-footer">
            <span class="readmore btn btn-outline-primary float-right">@App.Resources.ReadMore</span>
          </div>
        </div>
      </article>
    }
  </div>

  @* Show pagination if configured *@
  @if (Content.ShowPagination) {
    @RenderPage("shared/_List Paging.cshtml")
  }
</section>

@functions{
  /// <summary>
  /// Prevent duplicated search results.
  /// Since the main list will already add all the items to the search, this view should not add them again.
  /// </summary>
  public override void CustomizeSearch(Dictionary<string, List<ISearchItem>> searchInfos, IContainer moduleInfo, DateTime beginDate) {
    searchInfos.Clear();
  }
}
